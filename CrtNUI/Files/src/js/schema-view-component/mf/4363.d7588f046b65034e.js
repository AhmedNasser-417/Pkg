(self.webpackChunkapp_studio_enterprise_schema_view=self.webpackChunkapp_studio_enterprise_schema_view||[]).push([[4363],{3272:(x,A,i)=>{i.d(A,{A:()=>P});var g=i(94450),l=i.n(g);const P=new g.InjectionToken("ROUTER_OUTLET_HISTORY_VIEW_LIMIT_TOKEN")},15915:(x,A,i)=>{i.d(A,{B:()=>D});var g=i(33177),l=i.n(g),P=i(49475),w=i.n(P),R=i(34617),y=i.n(R),v=i(97600),E=i.n(v),N=i(3272),d=i(32935),S=i(94450),T=i.n(S);class D{get lastTransition(){return this._lastTransition}get length(){return this._items.length}constructor(s,o,r){var n;this._window=s,this._featureValues=r,this._historyLimit=20,this._items=[],this._previous=-1,this._current=-1,o!==null&&(this._historyLimit=o),((n=this._window).__crtHistory??(n.__crtHistory=[])).push(this)}_assertIndexedState(s){if(!("historyIndex"in s)||isNaN(s.historyIndex))throw new Error("History state should have historyIndex.")}_enforceHistoryLimit(){for(let s=this._current+1;s<this._items.length;s++)this.destroy(s);for(let s=0;s<this._current-this._historyLimit;s++)this.destroy(s)}destroy(s){const o=this._items[s];o?.view&&(o.view.destroy(),o.view=null)}_hasChildrenState(s){const o=s.state;return!(0,v.isEmpty)(o.children)}_getRootViewForChildrenRouting(){let s=!0;const o=this._items[this._current].state;for(let r=this._current-1;r>=0;r--){const n=this._items[r];if((0,v.isEmpty)(n)||!s)return null;if((0,R.crtStatesEqual)(o,n.state)&&s&&!(0,v.isEmpty)(n?.view?.pageRef))return n.view;s=this._hasChildrenState(n)}return null}goTo(s){this._assertIndexedState(s),this._previous=this._current,this._current=s.historyIndex;const o=this._current<this._previous,r=o&&!this._items[this._current],n=this._current===this._previous,u=this._current>this._previous;this._lastTransition={isBack:o,isReplace:n,isPush:u},!(s.silent&&!s._internalNotSilentIn8x&&!o)&&(n&&this.destroy(this._previous),(r||n||u)&&(this._items[this._current]={state:s}),u&&this._items.splice(this._current+1),this._enforceHistoryLimit())}canRestoreView(){const o=this._getCurrentView()?.pageRef;return this._current<this._previous&&Boolean(o)}_getCurrentView(){const s=this._items[this._current],o=this._hasChildrenState(s);let r;return o&&(0,v.isEmpty)(s?.view?.pageRef)&&(r=this._getRootViewForChildrenRouting()),r?new d.f7(r.pageRef,s?.view?.modalRefs,r.schemaState,r.pageRefReusable,r.scrollPositions,this._featureValues):s?.view}getView(){if(!this.canRestoreView())throw new Error("Cannot restore view");return this._getCurrentView()}getViewByOffset(s){return this._items[this._current+s]?.view}validateBeforeStore(s){const o=this._items[this._current].view;if(o?.pageRef&&o?.pageRef!==s.pageRef)throw new Error("This history item already contain another view. If you want to change view, do replace history state first.")}storeView(s){this.validateBeforeStore(s),this._items[this._current].view=s}}D.\u0275fac=function(s){return new(s||D)(S.\u0275\u0275inject(g.WINDOW_TOKEN),S.\u0275\u0275inject(N.A,8),S.\u0275\u0275inject(P.FEATURE_VALUES))},D.\u0275prov=S.\u0275\u0275defineInjectable({token:D,factory:D.\u0275fac})},85431:(x,A,i)=>{i.d(A,{vq:()=>j,ex:()=>O});var g=i(27049);const l=1;class P{constructor(c,f){this._bindingContext=c,this._dataGridViewConfig=f}getViewModelItemsAttributeName(){const c=this._dataGridViewConfig.items;if(c&&typeof c=="string")return c.substring(l)}getViewModel(){return this._bindingContext.viewModel$.pipe((0,g.take)(1))}getDataSourceName(){return this.getViewModel().pipe((0,g.map)(c=>c.getBoundDataSourceName(this.getViewModelItemsAttributeName())))}}var w=i(41307),R=i(34038);const y="DisableCompiledCellView",v="EnableDataGridColumnEdit";function E(V){return V.getFeatureState(y).pipe((0,g.distinctUntilChanged)(),(0,g.map)(c=>!c))}const N={provide:R.USE_DATA_TABLE_COMPILED_CELLS_VIEW,useFactory:E,deps:[w.FeatureService]};var d=i(94450),S=i(14537);class T{resolve(c){return new P(c.get(S.BINDING_CONTEXT),c.get(S.VIEW_ELEMENT_CONFIG))}}T.\u0275fac=function(c){return new(c||T)},T.\u0275prov=d.\u0275\u0275defineInjectable({token:T,factory:T.\u0275fac,providedIn:"root"});var D=i(46338),C=i(21322);class s{constructor(c,f){this._featureService=c,this._rightsService=f}getFeatures(){return(0,C.forkJoin)([this._featureService.getFeatureState(D.DISABLE_DATA_GRID_EDITING_MODE_FEATURE_CODE),this._featureService.getFeatureState(v),this._rightsService.getCanExecuteOperation(D.CAN_CREATE_DEFAULT_GRID_SETTING_OPERATION_CODE)]).pipe((0,g.map)(([c,f,M])=>({rows:{toolbar:!0,numeration:!0,selection:{enable:!1,multiple:!1}},columns:{toolbar:!0,sorting:!0,resizing:!0,dragAndDrop:!0,editing:f,adding:!0},cells:{selection:!0},header:{visible:!0},operations:{canCreateDefaultGridSettings:M},editable:!c})))}}s.\u0275fac=function(c){return new(c||s)(d.\u0275\u0275inject(w.FeatureService),d.\u0275\u0275inject(w.RightsService))},s.\u0275prov=d.\u0275\u0275defineInjectable({token:s,factory:s.\u0275fac,providedIn:"root"});let o={};const r={provide:R.DATA_GRID_FEATURES,useFactory:()=>o};class n{constructor(c){this._dataGridFeaturesService=c}init(){return this._dataGridFeaturesService.getFeatures().pipe((0,g.tap)(c=>o=c),(0,g.map)(()=>{}))}}n.\u0275fac=function(c){return new(c||n)(d.\u0275\u0275inject(s))},n.\u0275prov=d.\u0275\u0275defineInjectable({token:n,factory:n.\u0275fac,providedIn:"root"});var u=i(8239),h=i(49475),p=i(52045),I=i(24709),L=i(97600);class O extends D.BaseDataGridStateHandlerService{constructor(c,f,M,_,e,t,a,m){super(c),this._schemaPartsService=f,this._metadataModifierService=M,this._featureValues=_,this._dataGridDesignSettingsProvider=e,this._dataGridDesignSettingsUpdater=t,this._dataGridActiveFolderDesignSettingsProvider=a,this._dataGridMetadataTransferService=m}_getActiveFolderDataGridDesignSettings(c){return this.viewModel$.pipe((0,g.switchMap)(f=>this._dataGridActiveFolderDesignSettingsProvider.get({viewConfig:c,viewModel:f,metadata:this.schemaService.schema})))}_saveSettingsForFolder(c,f){const{columns:M,viewElementConfig:_}=f,e=(0,L.cloneDeep)(M),t=c.columns?.map(m=>m?.viewMetadata);this._metadataModifierService.revert(e),this._setColumnsCaptionResourceMacros(e,t);const a=this._dataGridDesignSettingsUpdater.updateColumns(c,e,_);return this.viewModel$.pipe((0,g.switchMap)(m=>this._dataGridActiveFolderDesignSettingsProvider.set({viewConfig:_,viewModel:m,metadata:this.schemaService.schema},a)),(0,g.switchMap)(()=>this._schemaPartsService.commit({silent:!1})),(0,g.map)(()=>{}))}_setColumnsCaptionResourceMacros(c,f){(c??[]).filter(M=>M&&!(0,h.isResourceMacros)(M.caption)).forEach(M=>{const _=this._getColumnCaptionResourceKey(M,f);M.caption=(0,h.toResourceMacros)(_)})}_getColumnCaptionResourceKey(c,f){const M=f?.find(t=>t?.id&&t.id===c.id),_=(0,h.extractResourcesKey)(M?.caption),e=(0,R.createDataGridColumnCaptionResourceKey)(c);return _||e}_saveSettingsToProfile(c){var f=this;const{columns:M,viewElementConfig:_}=c,e=(0,L.cloneDeep)(M);let t=e?.some(a=>a.changed);return(0,C.from)(this._schemaPartsService.apply(function(){var a=(0,u.Z)(function*([m,F]){const B=m.getViewConfigInfoByName(_?.name)?.viewConfig;if(!B)return;const K=yield f._dataGridDesignSettingsProvider.get(B,m,F),W=K.columns?.map(k=>k?.viewMetadata).filter(Boolean);f._metadataModifierService.revert(e),f._setColumnsCaptionResourceMacros(e,W),t=t||e?.length!==W?.length;const H=f._dataGridDesignSettingsUpdater.updateColumns(K,e,B);B._designOptions?.designSettings||(yield f._revertDeprecatedMetadata(B.name,H,m,F)),(0,L.set)(B,"_designOptions.designSettings",H)});return function(m){return a.apply(this,arguments)}}())).pipe((0,g.switchMap)(()=>this._schemaPartsService.commit({silent:t===!1})),(0,g.map)(()=>{}))}_revertDeprecatedMetadata(c,f,M,_){var e=this;return(0,u.Z)(function*(){const[t]=yield e._schemaPartsService.use("ALL_EMPLOYERS");yield e._dataGridMetadataTransferService.transfer(t,M,c);const a={localizableStrings:{}};Object.keys(f.resources?.localizableStrings).forEach(m=>a.localizableStrings[m]=void 0),yield _.upsertResources(a)})()}innerHandle(c){return this._featureValues.DisableDataGridSettingsByFolders?this._saveSettingsToProfile(c):this._getActiveFolderDataGridDesignSettings(c.viewElementConfig).pipe((0,g.switchMap)(f=>f?this._saveSettingsForFolder(f,c):this._saveSettingsToProfile(c)))}handle(c,f){return super.handle({...c},f)}}O.\u0275fac=function(c){return new(c||O)(d.\u0275\u0275inject(p.SchemaService),d.\u0275\u0275inject(p.SchemaPartsService),d.\u0275\u0275inject(I.MetadataModifierService),d.\u0275\u0275inject(h.FEATURE_VALUES),d.\u0275\u0275inject(R.DataGridDesignSettingsProvider),d.\u0275\u0275inject(R.DataGridDesignSettingsUpdater),d.\u0275\u0275inject(R.DataGridActiveFolderDesignSettingsProvider),d.\u0275\u0275inject(R.DataGridMetadataTransferService))},O.\u0275prov=d.\u0275\u0275defineInjectable({token:O,factory:O.\u0275fac});var U=i(74742),G=i(75378);function b(V){return()=>(0,C.lastValueFrom)(V.init(),{defaultValue:null})}let j=class{};j.\u0275fac=function(c){return new(c||j)},j.\u0275mod=d.\u0275\u0275defineNgModule({type:j}),j.\u0275inj=d.\u0275\u0275defineInjector({providers:[r,N,{provide:d.APP_INITIALIZER,useFactory:b,deps:[n],multi:!0}],imports:[D.CrtDataGridCdkModule,R.CrtDataGridToolbarModule]}),j=(0,U.__decorate)([(0,G.CrtModule)({includes:[D.CrtDataGridCdkModule]})],j),function(){(typeof ngJitMode>"u"||ngJitMode)&&d.\u0275\u0275setNgModuleScope(j,{imports:[D.CrtDataGridCdkModule],exports:[R.CrtDataGridToolbarModule]})}()},32935:(x,A,i)=>{i.d(A,{aK:()=>l,Hi:()=>g,HO:()=>N,TV:()=>v,pb:()=>y,dh:()=>E,Vr:()=>D,f7:()=>w});class g{constructor(s){s&&(this.title=s.title,this.schemaName=s.schemaName)}}class l{}var P=i(21322);class w{constructor(s=null,o=new Map,r=s?.instance?.schemaState,n=!1,u=s?.instance?.scrollPositions,h={}){this.pageRef=s,this.modalRefs=o,this.schemaState=r,this.pageRefReusable=n,this.scrollPositions=u,this._featureValues=h,this.isDestroyed=!1}_destroyModalViews(){const s=this?.modalRefs;s?.size&&(Array.from(s.values()).forEach(o=>o.close()),this.modalRefs.clear())}_destroyViewModelAsync(s){return this._featureValues.DisableHandleFixedViewModelResumePauseRequest?s?.destroy().pipe((0,P.take)(1)):(0,P.concat)(s?.pause()??(0,P.of)(),s?.destroy()??(0,P.of)()).pipe((0,P.take)(2))}destroy(){if(this._destroyModalViews(),this.pageRefReusable)this.pageRef?.instance?.schemaComponent?.clearResources(this.schemaState.viewModel),this._destroyViewModelAsync(this.schemaState.viewModel).subscribe(),this.schemaState.viewModel=null,this.schemaState.models=null,this.schemaState=null;else{const s=this.pageRef?.instance?.schemaComponent?.schemaState;this._destroyViewModelAsync(s?.viewModel).subscribe(),this.pageRef?.destroy(),this.pageRef?.hostView?.destroy(),this.pageRef=null}this.isDestroyed=!0}get viewModel(){return this._featureValues?.UseSchemaOutletReuseViewStrategy?this?.schemaState?.viewModel:this?.pageRef?.instance?.schemaState?.viewModel}}var R=i(94450),y;(function(C){C.LookupValues="lookupValues",C.Filter="filter"})(y||(y={}));const v=y.LookupValues;var E;(function(C){C[C.Legacy=0]="Legacy",C[C.New=1]="New"})(E||(E={}));const N=new R.InjectionToken("PageLookupDataToken");var d=i(8239),S=i(75378),T=i(97600);class D{get canceled(){return this._canceled}get filter(){return this._filter}constructor(s){this._cachedLookupValues=[],this._entityName=s?.entityName,this._selectionState=s?.selectionState,this._filter=s?.filter,this._cachedLookupValues=s?.cachedLookupValues??[],this._canceled=s?.canceled??!1}_getFilterByPrimaryValues(s,o){const r=new S.EntitySchemaQuery("tempTable"),n=new S.ColumnExpression({columnPath:s}),u=o.map(I=>new S.ParameterExpression({value:I})),h=new S.InFilter(S.ComparisonType.Equal,n,u);return r.filters.add(h),r.getMetadata().filters}_loadLookupValues(s,o,r,n){return(0,d.Z)(function*(){const{primaryAttributeName:u,primaryDisplayAttributeName:h,primaryColorAttributeName:p}=o,I=[u,h,p].filter(Boolean);return(yield s.load({attributes:I,parameters:[{type:S.ModelParameterType.Filter,value:r}],options:n?{pagingConfig:n}:{}})).map(O=>({value:O[u],displayValue:O[h],primaryColorValue:O[p]}))})()}_loadLookupValuesByPrimaryValues(s,o){var r=this;return(0,d.Z)(function*(){if(!o.length)return[];const n=yield S.Model.create(s),u=yield n.getSchema(),h=r._getFilterByPrimaryValues(u.primaryAttributeName,o);return r._loadLookupValues(n,u,h)})()}_isCached(s){return this._cachedLookupValues.some(o=>o.value===s)}getLookupValues(s){var o=this;return(0,d.Z)(function*(){if(!o._selectionState||o.canceled)return[];const r=s?.pagingConfig;if(o._selectionState?.type==="specific"){let n;(0,T.isUndefined)(r?.rowsOffset)||(0,T.isUndefined)(r?.rowCount)?n=[...o._selectionState.selected]:n=o._selectionState.selected.slice(r?.rowsOffset,r?.rowsOffset+r?.rowCount);const u=n.filter(p=>!o._isCached(p)),h=yield o._loadLookupValuesByPrimaryValues(o._entityName,u);return n.map(p=>o._cachedLookupValues.find(I=>I.value===p)||h.find(I=>I.value===p))}else{const n=yield S.Model.create(o._entityName),u=yield n.getSchema();return o._loadLookupValues(n,u,o._filter,r)}})()}}},491:(x,A,i)=>{i.d(A,{jZ:()=>G,SX:()=>N,j_:()=>n,Tx:()=>M,b:()=>L,zi:()=>r,jW:()=>h,mJ:()=>u,dO:()=>O,am:()=>b.a,Gm:()=>E,F$:()=>j.F,Lu:()=>j.L,Q1:()=>I,N1:()=>d,FL:()=>D,Wn:()=>f});var g=i(2876),l=i(94450),P=i(75378),w=i(77207),R=i(49475),y=i(97600),v=i(21322),E;(function(_){_[_.AddRelatedRecords=0]="AddRelatedRecords",_[_.RemoveRelatedRecords=1]="RemoveRelatedRecords"})(E||(E={}));class N{constructor(){this._translateService=(0,l.inject)(w.TranslateService),this._httpClient=(0,l.inject)(g.HttpClient),this._userInfo=(0,l.inject)(R.UserInfo)}get _relatedInMainRecordsServiceEndpoint(){return(this._userInfo.isSSP?"ssp/":"")+`rest/${this.relatedInMainRecordsServiceName}/`}_isInvalidParameters(e){return(0,y.isEmpty)(e.relatedRecordsSchemaName)||(0,y.isEmpty)(e.relatedInMainRecordsSchemaName)||(0,y.isEmpty)(e.relatedRecordColumnName)||(0,y.isEmpty)(e.mainRecordColumnName)||!this._isValidFilters(e.relatedRecordsFilters)||!this._isValidFilters(e.mainRecordsFilters)}_isValidFilters(e){return(0,y.isObject)(e)&&"items"in e&&!(0,y.isEmpty)(e.items)}_catchHttpErrorResponse(e){return(0,v.of)({success:!1,message:e.error?.errorInfo?.message??e.message})}_createEsqWithFilters(e,t){const a=new P.EntitySchemaQuery(e);return this._addFiltersToEsq(a,t),a}_addFiltersToEsq(e,t){Object.entries(t.items).forEach(([a,m])=>{e.filters.add(m,a)})}getServiceResultMessage(e,t,a){if(e.success){const m=this.relatedRecordsActionsNames.get(t);return this._translateService.instant(`${this.relatedInMainRecordsServiceName}.ServiceResult.${m}${a}`,{count:(0,y.get)(e,"processedRecordsCount",null)})}return e.errorInfo?.message||this._translateService.instant("BaseRelatedInMainRecordsService.ServiceResult.ErrorMessage")}executeAction(e,t){return this._isInvalidParameters(t)?(0,v.of)({success:!1,message:this._translateService.instant("BaseRelatedInMainRecordsService.NotValidParametersMessage")}):this.process(e,t)}process(e,t){const a=this.createRelatedRecordsEsq(t),m=this.createMainRecordsEsq(t),F=this.createRequest(a,m,t);return this.callService(e,F,t)}createRelatedRecordsEsq(e){return this._createEsqWithFilters(e.relatedRecordsSchemaName,e.relatedRecordsFilters)}createMainRecordsEsq(e){return this._createEsqWithFilters(e.mainRecordsSchemaName,e.mainRecordsFilters)}callService(e,t,a){const m=this.relatedRecordsActionsNames.get(e);return this._httpClient.post(`${this._relatedInMainRecordsServiceEndpoint}${m}`,{request:t}).pipe((0,v.map)(F=>({success:F.success,message:this.getServiceResultMessage(F,e,"Message")})),(0,v.catchError)(F=>this._catchHttpErrorResponse(F)))}addRelatedRecords(e){return this.executeAction(E.AddRelatedRecords,e)}removeRelatedRecords(e){return this.executeAction(E.RemoveRelatedRecords,e)}}class d extends N{constructor(){super(...arguments),this.relatedInMainRecordsServiceName="StaticFolderService",this.relatedRecordsActionsNames=new Map([[E.AddRelatedRecords,"AddRecords"],[E.RemoveRelatedRecords,"RemoveRecords"]])}createRequest(e,t,a){return{recordsEsqSerialized:JSON.stringify(e.getMetadata()),foldersEsqSerialized:JSON.stringify(t.getMetadata()),recordInFolderRecordsSchemaName:a.relatedInMainRecordsSchemaName,recordColumnName:a.relatedRecordColumnName,folderColumnName:a.mainRecordColumnName,defaultValues:a.defaultValues?JSON.stringify(a.defaultValues):null}}}d.\u0275fac=function(){let _;return function(t){return(_||(_=l.\u0275\u0275getInheritedFactory(d)))(t||d)}}(),d.\u0275prov=l.\u0275\u0275defineInjectable({token:d,factory:d.\u0275fac});var S=i(41307),T=i(6523);class D extends N{constructor(){super(...arguments),this._featureValues=(0,l.inject)(R.FEATURE_VALUES),this._processEngineService=(0,l.inject)(S.ProcessEngineService),this._queryExecutor=(0,l.inject)(T.QueryExecutor),this._disableAsyncTaggingFeatureName="DisableAsyncTagging",this._taggingProcessName="TaggingProcess",this._syncRequestMaxRecordsCount=200,this.relatedInMainRecordsServiceName="TaggingService",this.relatedRecordsActionsNames=new Map([[E.AddRelatedRecords,"AddTags"],[E.RemoveRelatedRecords,"RemoveTags"]])}_isDisabledAsyncTagging(){return!!this._featureValues[this._disableAsyncTaggingFeatureName]}_callProcess(e,t){const a=this._createProcessParameters(e,t);return this._processEngineService.executeProcessByName(this._taggingProcessName,a).pipe((0,v.map)(m=>({success:m.success,message:super.getServiceResultMessage(m,e,"SuccessfulRunProcess")})))}_createProcessParameters(e,t){return{TaggingAction:this.relatedRecordsActionsNames.get(e),RecordsEsqSerialized:t.recordsEsqSerialized,TagsEsqSerialized:t.tagsEsqSerialized,TagInRecordSchemaName:t.tagInRecordSchemaName,RecordColumnName:t.recordColumnName,TagColumnName:t.tagColumnName,DefaultValues:t.defaultValues}}_getRecordsCount(e){const t=this.createRelatedRecordsEsq(e);this._addRowCountToEsq(t);const a=this.createMainRecordsEsq(e);return this._addRowCountToEsq(a),(0,v.forkJoin)([this._getEsqRecordsCount(t),this._getEsqRecordsCount(a)]).pipe((0,v.map)(([m,F])=>m*F))}_addRowCountToEsq(e){e.rowCount=this._syncRequestMaxRecordsCount+1}_getEsqRecordsCount(e){return this._queryExecutor.executeSelectQuery(e).pipe((0,v.map)(t=>t.length))}_isNeedCallService(e){return this._isDisabledAsyncTagging()?(0,v.of)(!0):this._getRecordsCount(e).pipe((0,v.map)(t=>t<=this._syncRequestMaxRecordsCount))}createRequest(e,t,a){return{recordsEsqSerialized:JSON.stringify(e.getMetadata()),tagsEsqSerialized:JSON.stringify(t.getMetadata()),tagInRecordSchemaName:a.relatedInMainRecordsSchemaName,recordColumnName:a.relatedRecordColumnName,tagColumnName:a.mainRecordColumnName,defaultValues:a.defaultValues?JSON.stringify(a.defaultValues):null}}callService(e,t,a){return this._isNeedCallService(a).pipe((0,v.switchMap)(m=>m?super.callService(e,t,a):this._callProcess(e,t)))}}D.\u0275fac=function(){let _;return function(t){return(_||(_=l.\u0275\u0275getInheritedFactory(D)))(t||D)}}(),D.\u0275prov=l.\u0275\u0275defineInjectable({token:D,factory:D.\u0275fac});var C=i(8239),s=i(27049),o=i(32935);const r="Desktop",n="CrtCurrentDesktop";class u{constructor(e,t,a,m){this._queryExecutor=e,this._sysSettingsService=t,this._rightsService=a,this._userProfileService=m,this._canEditDesktopOperationName="CanManageSolution",this._currentDesktopSchemaNameInitialized=!1,this._canEditDesktopSchemaInitialized=!1,this._canEditDesktopSchema=!1}_convertToDesktops(e,t){const a=t.get("schemaName"),m=t.get("title");return e.map(F=>new o.Hi({schemaName:F[a],title:F[m]}))}_requestDesktopSysSetting(){return(0,v.lastValueFrom)(this._sysSettingsService.getValueByCode(n,""))}_requestDesktopProfileSettings(){return(0,v.lastValueFrom)(this._userProfileService.getProfile(n))}getCurrentDesktopSchemaName(){var e=this;return(0,C.Z)(function*(){if(!e._currentDesktopSchemaNameInitialized){let t=yield e._requestDesktopProfileSettings();(0,y.isEmpty)(t)&&(t=yield e._requestDesktopSysSetting()),e._currentDesktopSchemaName=t,e._currentDesktopSchemaNameInitialized=!0}return e._currentDesktopSchemaName})()}getUserDesktops(){const e=new Map([["schemaName","DesktopSchemaName"],["title","Title"]]),t=new P.EntitySchemaQuery(r);return t.addSchemaColumn(e.get("schemaName")),t.addSchemaColumn(e.get("title")),(0,v.firstValueFrom)(this._queryExecutor.executeSelectQuery(t).pipe((0,v.map)(a=>this._convertToDesktops(a,e))))}setCurrentDesktop(e){var t=this;return(0,C.Z)(function*(){const a=e?e.schemaName:null;t._currentDesktopSchemaName=a,yield(0,v.firstValueFrom)(t._userProfileService.saveProfile(n,a))})()}canEditDesktop(){return this._canEditDesktopSchemaInitialized?Promise.resolve(this._canEditDesktopSchema):(0,v.lastValueFrom)(this._rightsService.getCanExecuteOperation(this._canEditDesktopOperationName).pipe((0,s.tap)(e=>{this._canEditDesktopSchema=e,this._canEditDesktopSchemaInitialized=!0})))}}u.\u0275fac=function(e){return new(e||u)(l.\u0275\u0275inject(T.QueryExecutor),l.\u0275\u0275inject(S.SysSettingsService),l.\u0275\u0275inject(S.RightsService),l.\u0275\u0275inject(S.UserProfileService))},u.\u0275prov=l.\u0275\u0275defineInjectable({token:u,factory:u.\u0275fac,providedIn:"root"});class h{constructor(){this._repository=new Map}set(e,t){this._repository.set(e,t)}get(e){return this._repository.get(e)}getAll(){return Array.from(this._repository.values())}}h.\u0275fac=function(e){return new(e||h)},h.\u0275prov=l.\u0275\u0275defineInjectable({token:h,factory:h.\u0275fac,providedIn:"root"});var p=i(24709);class I extends p.DataSourceFactoryService{constructor(e,t,a){super(t,a),this._dataSourceRepository=e}create(e,t,a){return super.create(e,t,a).pipe((0,s.tap)(m=>{this._dataSourceRepository.set(e,m)}))}}I.\u0275fac=function(e){return new(e||I)(l.\u0275\u0275inject(h),l.\u0275\u0275inject(l.Injector),l.\u0275\u0275inject(p.DataSourceTypeResolver))},I.\u0275prov=l.\u0275\u0275defineInjectable({token:I,factory:I.\u0275fac});class L{constructor(e){this._configurationDataService=e}getConfigurationStructure(){return this._configurationDataService.getData(!0).pipe((0,v.map)(e=>{if(!e.success)throw new Error(e.errorInfo.message);return e.data}))}}L.\u0275fac=function(e){return new(e||L)(l.\u0275\u0275inject(S.ConfigurationDataService))},L.\u0275prov=l.\u0275\u0275defineInjectable({token:L,factory:L.\u0275fac,providedIn:"any"});class O extends R.BaseFileUploadProcessingService{constructor(e,t){super(e,t)}createFileErrorMessageForLogs(e){return super.createFileErrorMessageForLogs(e)}processSelectedFiles(e,t){var a=()=>super.processSelectedFiles,m=this;return(0,C.Z)(function*(){return a().call(m,e,t)})()}}O.\u0275fac=function(e){return new(e||O)(l.\u0275\u0275inject(w.TranslateService),l.\u0275\u0275inject(P.SysSettingsService))},O.\u0275prov=l.\u0275\u0275defineInjectable({token:O,factory:O.\u0275fac,providedIn:"root"});var U=i(34617);class G{getDefaultAppearanceSettings(e){return(0,v.from)(U.NavigationUtils.isMiniPage(e)).pipe((0,v.map)(t=>({modalSettings:{size:t?R.ModalSize.Small:R.ModalSize.ExtraLarge}})))}}var b=i(39630),j=i(76596),V=i(33177),c=i(15915);class f extends p.ViewModelDataDelayer{constructor(e,t,a,m){super(),this._crtRouter=e,this._routerOutletHistory=t,this._featureValues=a,this._window=m,this._disableDelayingModelEventsFeatureName="DisableDelayingModelEvents",this._disableDelayingModelsEventFeatureState=!1,this._disableOffsetForDelayingModelEventsFeatureName="DisableOffsetForDelayingModelEvents",this._disableOffsetForDelayingModelEventsFeatureState=!1,this._defaultViewLoadingOffset=-1,this._subscriptions=new v.Subscription,this._loadTriggerSubject=new v.Subject,this.loadTrigger$=this._loadTriggerSubject.asObservable(),this._isAngularHost=(0,y.get)(this._window,"Terrasoft")?.isAngularHost,this._isAngularHost&&(this._initFeatureStates(),this._disableDelayingModelsEventFeatureState||this._subscribeOnNavigation())}setViewModel(e){this._viewModel||(this._viewModel=e)}_initFeatureStates(){this._disableDelayingModelsEventFeatureState=this._featureValues[this._disableDelayingModelEventsFeatureName]??!1,this._disableDelayingModelsEventFeatureState||(this._disableOffsetForDelayingModelEventsFeatureState=this._featureValues[this._disableOffsetForDelayingModelEventsFeatureName]??!1),this._viewLoadingOffset=this._disableOffsetForDelayingModelEventsFeatureState?0:this._defaultViewLoadingOffset}_shouldLoadForModals(e,t){return e&&e.modalRefs?Array.from(e.modalRefs.values()).some(a=>a?.componentInstance?.page?.schemaState?.viewModel===t):!1}_shouldLoadForPage(e,t){return e?.viewModel===t}_getViews(){const e=[];for(let t=this._viewLoadingOffset;t<=0;t++)e.push(this._routerOutletHistory.getViewByOffset(t));return e}_shouldLoadForViews(){const e=(0,p.getRootViewModel)(this._viewModel);return this._getViews().some(a=>{const m=this._shouldLoadForPage(a,e),F=this._shouldLoadForModals(a,e);return m||F})}_shouldLoad(){return this?._routerOutletHistory?this._shouldLoadForViews():!1}_subscribeOnNavigation(){this._subscriptions.add(this._crtRouter?.navigateEnd$.subscribe(()=>{this._shouldLoad()&&this._loadTriggerSubject.next()}))}shouldBeDelayed(){return!this._isAngularHost||this._disableDelayingModelsEventFeatureState?!1:this._viewModel.State===p.ViewModelStates.Paused&&!this._shouldLoad()}setState(e,t){this._disableDelayingModelsEventFeatureState||e._setStateAttribute(t)}destroy(){this._subscriptions.unsubscribe(),this._loadTriggerSubject.complete(),this._viewModel=null}ngOnDestroy(){this.destroy()}}f.\u0275fac=function(e){return new(e||f)(l.\u0275\u0275inject(U.CrtRouter,8),l.\u0275\u0275inject(c.B,8),l.\u0275\u0275inject(R.FEATURE_VALUES),l.\u0275\u0275inject(V.WINDOW_TOKEN))},f.\u0275prov=l.\u0275\u0275defineInjectable({token:f,factory:f.\u0275fac});class M extends S.BaseCachedHttpService{constructor(){super(...arguments),this.serviceEndpoint="/ServiceModel/ClientUnitSchemaDesignerService.svc"}getParentSchemasLocalizableStrings(e){return this.executePostRequestWithCache("GetParentSchemasLocalizableStrings",{schemaUId:e})}}M.\u0275fac=function(){let _;return function(t){return(_||(_=l.\u0275\u0275getInheritedFactory(M)))(t||M)}}(),M.\u0275prov=l.\u0275\u0275defineInjectable({token:M,factory:M.\u0275fac})},39630:(x,A,i)=>{i.d(A,{a:()=>E});var g=i(41307),l=i.n(g),P=i(52045),w=i.n(P),R=i(32935),y=i(94450),v=i.n(y);class E extends P.ProfileSchemaProvider{constructor(d,S){super(d),this._data=S}getProfileKey(d){return super.getProfileKey(d)+"__"+this._data.entitySchemaName}}E.\u0275fac=function(d){return new(d||E)(y.\u0275\u0275inject(g.UserSchemaProfileService),y.\u0275\u0275inject(R.HO))},E.\u0275prov=y.\u0275\u0275defineInjectable({token:E,factory:E.\u0275fac})},76596:(x,A,i)=>{i.d(A,{F:()=>C,L:()=>s});var g=i(8239),l=i(94450),P=i.n(l),w=i(34038),R=i.n(w),y=i(49475),v=i.n(y),E=i(24709),N=i.n(E),d=i(21322),S=i.n(d),T=i(27049),D=i.n(T);const C=new l.InjectionToken("SCHEMA_MODAL_COMPONENT_TYPE");class s{constructor(r,n,u){this._modalProviderService=r,this._appearanceSettingsService=n,this._schemaModalComponentType=u,this._createdModalsMap=new Map,this._modalCreated=new d.Subject,this._modalClosed=new d.Subject,this.modalCreated$=this._modalCreated.asObservable(),this.modalClosed$=this._modalClosed.asObservable()}_getDialogConfig(r){var n=this;return(0,g.Z)(function*(){const u=yield n._appearanceSettingsService.getSchemaModalClasses(r);return{panelClass:["modal-container",...u],maxWidth:0,maxHeight:"90vh",closeOnNavigation:!1}})()}_onModalClose(r){const h=this._createdModalsMap.get(r).componentInstance.schemaOutletComponent.instance.componentRef.instance.schemaState?.viewModel;this._createdModalsMap.delete(r),this._modalClosed.next(r),(0,d.concat)(h?.pause()??(0,d.of)(null),h?.destroy()??(0,d.of)(null)).pipe((0,T.take)(2)).subscribe()}_onModalCreate(r){this._createdModalsMap.set(r.id,r),this._modalCreated.next(r),r.beforeClosed().pipe((0,T.take)(1)).subscribe(()=>this._onModalClose(r.id))}hideModals(r){const n=this._createdModalsMap;for(const u of r){const h=n.get(u);h&&(this._modalProviderService.hideModal(h),h.componentInstance.schemaOutletComponent.instance.componentRef.instance.onDetach(),h.componentInstance.detachContent())}}closeModals(){const r=this._createdModalsMap;for(const n of Array.from(r.keys())){const u=r.get(n);u&&u.close()}}restoreModals(r){const n=this._createdModalsMap;for(const u of r){const h=n.get(u);if(h){this._modalProviderService.restoreModal(h);const p=h.componentInstance.schemaOutletComponent.instance;h.componentInstance.attachContent(),p.componentRef.instance.onAttach()}}}show(r,n){var u=this;return(0,g.Z)(function*(){const h=yield u._getDialogConfig(r.schemaName);h.injector=n?.injector;const p=u._modalProviderService.open(u._schemaModalComponentType,{data:r,...h});return p.keydownEvents().pipe((0,T.filter)(()=>p.componentInstance.visible),(0,T.switchMap)(I=>{const O=p.componentInstance.page.schemaState.viewModel,U=new E.HandleKeyboardHotkeysRequest(I,O);return O.executeRequest(U)})).subscribe(),p.disableClose=!0,u._onModalCreate(p),p})()}}s.\u0275fac=function(r){return new(r||s)(l.\u0275\u0275inject(w.ModalProvider),l.\u0275\u0275inject(y.AppearanceSettingsService),l.\u0275\u0275inject(C))},s.\u0275prov=l.\u0275\u0275defineInjectable({token:s,factory:s.\u0275fac,providedIn:"root"})}}]);
